{"generatedAt":1668146824243,"generateTime":7,"contents":[{"_path":"/page/getting-started","_dir":"page","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Getting Started","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"create-a-new-project"},"children":[{"type":"text","value":"Create a new project"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"git","title":"Git"},"children":[{"type":"element","tag":"code","props":{"code":"$ git clone https://github.com/viandwi24/nuxt3-awesome-starter\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ git clone https://github.com/viandwi24/nuxt3-awesome-starter\n"}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"development"},"children":[{"type":"text","value":"Development"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# install dependencies\n$ pnpm install --shamefully-hoist\n\n# serve\n$ pnpm dev\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# install dependencies\n$ pnpm install --shamefully-hoist\n\n# serve\n$ pnpm dev\n"}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"build"},"children":[{"type":"text","value":"Build"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# build\n$ pnpm build\n\n# serve\n$ pnpm start\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# build\n$ pnpm build\n\n# serve\n$ pnpm start\n"}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"build-as-static-site"},"children":[{"type":"text","value":"Build as Static Site"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# generate static files\n$ pnpm generate\n\n# serve\n$ pnpm preview\n\n# or serve with \"serve\"\n$ npx serve ./dist/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"# generate static files\n$ pnpm generate\n\n# serve\n$ pnpm preview\n\n# or serve with \"serve\"\n$ npx serve ./dist/\n"}]}]}]}]}]}]}]},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"create-a-new-project"},"children":[{"type":"text","value":"Create a new project"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"git","title":"Git"},"children":[{"type":"element","tag":"code","props":{"code":"$ git clone https://github.com/viandwi24/nuxt3-awesome-starter\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ git clone https://github.com/viandwi24/nuxt3-awesome-starter"}]}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"development"},"children":[{"type":"text","value":"Development"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# install dependencies\n$ pnpm install --shamefully-hoist\n\n# serve\n$ pnpm dev\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# install dependencies"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm install --shamefully-hoist"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# serve"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm dev"}]}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"build"},"children":[{"type":"text","value":"Build"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# build\n$ pnpm build\n\n# serve\n$ pnpm start\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# build"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm build"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# serve"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm start"}]}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"build-as-static-site"},"children":[{"type":"text","value":"Build as Static Site"}]},{"type":"element","tag":"div","props":{"class":"mb-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"pnpm","title":"pnpm"},"children":[{"type":"element","tag":"code","props":{"code":"# generate static files\n$ pnpm generate\n\n# serve\n$ pnpm preview\n\n# or serve with \"serve\"\n$ npx serve ./dist/\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# generate static files"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm generate"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# serve"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ pnpm preview"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d3e951"},"children":[{"type":"text","value":"# or serve with \"serve\""}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b93775"},"children":[{"type":"text","value":"$ npx serve ./dist/"}]}]}]}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-d3e951{color:#6E7781}.ct-b93775{color:#24292F}.dark .ct-b93775{color:#C9D1D9}.dark .ct-d3e951{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"create-a-new-project","depth":2,"text":"Create a new project"},{"id":"development","depth":2,"text":"Development"},{"id":"build","depth":2,"text":"Build"},{"id":"build-as-static-site","depth":2,"text":"Build as Static Site"}]}},"_type":"markdown","_id":"content:page:getting-started.md","_source":"content","_file":"page/getting-started.md","_extension":"md"},{"_path":"/post/kvm-intro","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"虚拟化第一篇 Hypervisor、Libvirt、QEMU和KVM简介","description":"这是QEMU/KVM系列文章的第一篇","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"常见的-hypervisordriver"},"children":[{"type":"text","value":"常见的 Hypervisor/Driver"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Xen"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VMware"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"LXC"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"QEMU"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VirtualBox"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Microsoft Hyper-V（BSD hypervisor）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"IBM PowerVM"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"OpenVZ"}]}]},{"type":"element","tag":"h2","props":{"id":"libvirt"},"children":[{"type":"text","value":"libvirt"}]},{"type":"element","tag":"h3","props":{"id":"libvirt-简介"},"children":[{"type":"text","value":"libvirt 简介"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"虽然是用C语言编写的，但是也有其他语言的Bindings，比如Java，Perl，C#，Python，Ruby"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"一个稳定的管理VM的API界面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"构建在hypervisor上面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Client-Server架构"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"实现vm的配置、添加、修改、监控、迁移等功能"}]}]},{"type":"element","tag":"h3","props":{"id":"libvirt-结构"},"children":[{"type":"text","value":"libvirt 结构"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"driver-based-architecture","src":"/assets/images/driver-based-architecture.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hypervisor是第一级driver，而诸如CPU、网络、disk等各种设备是第二级的driver（secondary-level driver)"}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"ts","title":"C"},"children":[{"type":"element","tag":"code","props":{"code":"struct _virConnectDriver {\n    /* Whether driver permits a server in the URI */\n    bool localOnly;\n    /* Whether driver needs a server in the URI */\n    bool remoteOnly;\n    /* Whether driver can be used in embedded mode */\n    bool embeddable;\n    /*\n    * NULL terminated list of supported URI schemes.\n    *  - Single element { NULL } list indicates no supported schemes\n    *  - NULL list indicates wildcard supporting all schemes\n    */\n    const char **uriSchemes;\n    virHypervisorDriver *hypervisorDriver;\n    virInterfaceDriver *interfaceDriver;\n    virNetworkDriver *networkDriver;\n    virNodeDeviceDriver *nodeDeviceDriver;\n    virNWFilterDriver *nwfilterDriver;\n    virSecretDriver *secretDriver;\n    virStorageDriver *storageDriver;\n};\n","language":"c"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"struct _virConnectDriver {\n    /* Whether driver permits a server in the URI */\n    bool localOnly;\n    /* Whether driver needs a server in the URI */\n    bool remoteOnly;\n    /* Whether driver can be used in embedded mode */\n    bool embeddable;\n    /*\n    * NULL terminated list of supported URI schemes.\n    *  - Single element { NULL } list indicates no supported schemes\n    *  - NULL list indicates wildcard supporting all schemes\n    */\n    const char **uriSchemes;\n    virHypervisorDriver *hypervisorDriver;\n    virInterfaceDriver *interfaceDriver;\n    virNetworkDriver *networkDriver;\n    virNodeDeviceDriver *nodeDeviceDriver;\n    virNWFilterDriver *nwfilterDriver;\n    virSecretDriver *secretDriver;\n    virStorageDriver *storageDriver;\n};\n"}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"libvirt支持的hypervisor以及对应源码的目录"},"children":[{"type":"text","value":"Libvirt支持的Hypervisor以及对应源码的目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• esx/: VMware ESX and GSX support using vSphere API over SOAP"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• hyperv/: Microsoft Hyper-V support using WinRM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• lxc/: Linux native containers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• openvz/: OpenVZ containers using CLI tools"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• phyp/: IBM Power Hypervisor using CLI tools over SSH"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• qemu/: QEMU/KVM using the QEMU CLI/monitor"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• remote/: Generic libvirt native RPC client"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• test/: A mock driver for testing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• uml/: User-mode Linux"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vbox/: VirtualBox using the native API"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vmware/: VMware Workstation and Player using the vmrun tool"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xen/: Xen using hypercalls, XenD SEXPR, and XenStore"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xenapi: Xen using libxenserver"}]}]},{"type":"element","tag":"h3","props":{"id":"第二级driver以及对应目录"},"children":[{"type":"text","value":"第二级driver以及对应目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• cpu/: CPU feature management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• interface/: Host network interface management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• network/: Virtual NAT networking"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• nwfilter/: Network traffic filtering rules"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• node_device/: Host device enumeration"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• secret/: Secret management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• security/: Mandatory access control drivers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• storage/: Storage management drivers"}]}]},{"type":"element","tag":"h3","props":{"id":"五个主要的对象以及它们之间的关系"},"children":[{"type":"text","value":"五个主要的对象以及它们之间的关系"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/api-objs.png"},"children":[]}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virConnectPtr: Libvirt需要连接到一个hypervisor，该对象代表了这种连接"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virDomainPtr: host和guest都被叫做domain，该对象表示一个主机"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStorageVolPtr: 代表存储系统的一卷（volume）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStoragePoolPtr: 一个volume是一个storage pool的一部分"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virNetworkPtr: 代表一个虚拟网络"}]}]},{"type":"element","tag":"h2","props":{"id":"qemu"},"children":[{"type":"text","value":"qemu"}]},{"type":"element","tag":"h3","props":{"id":"qemu是什么"},"children":[{"type":"text","value":"qemu是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU由Fabrice Bellard撰写，同时他也是ffmpeg的作者，以GPL协议开源。\n当它以emulater的角色工作时，它采用动态二进制翻译让机器可以跑另一种指令集的程序/OS。\n负责翻译工作的部分叫做TCG，它其实是个JIT（just in time）编译器。\n"},{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/tcg-qemu.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当它以virtualizer的角色工作时，就需要监控vm，与KVM通信合作实现带有硬件加速的虚拟化（部分指令直接跑在host主机上）。qemu利用POSIX Thread做到了这一点，也就是说，guest的vCPU其实是host的thread。\n"},{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/qemu-kvm.png"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"qemu源码预览"},"children":[{"type":"text","value":"qemu源码预览"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU-KVM 维护了一组CPU（X86）structures， 每一个vCPU对应一个结构。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n通用寄存器的内容记录在CPUState。"}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"KVMState","title":"C"},"children":[{"type":"element","tag":"code","props":{"code":"struct KVMState\n{\n    ...\n    int fd; //open /dev/kvm 后的file descriptor\n    int vmfd;\n    int coalesced_mmio;\n    int coalesced_pio;\n    struct kvm_coalesced_mmio_ring *coalesced_mmio_ring;\n    ...\n};\nstruct CPUState {\n    ...\n    int nr_cores;\n    int nr_threads;\n    ...\n    int kvm_fd;\n    struct KVMState *kvm_state;\n    struct kvm_run *kvm_run;\n    ...\n};\ntypedef struct CPUArchState {\n    /* standard registers */\n    target_ulong regs[CPU_NB_REGS];\n    target_ulong eip;\n    ...\n    uint64_t system_time_msr;\n    uint64_t wall_clock_msr;\n    ...\n    /* exception/interrupt handling */\n    int error_code;\n    int exception_is_int;\n    target_ulong exception_next_eip;\n    ...\n} CPUX86State;\n","language":"c"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"struct KVMState\n{\n    ...\n    int fd; //open /dev/kvm 后的file descriptor\n    int vmfd;\n    int coalesced_mmio;\n    int coalesced_pio;\n    struct kvm_coalesced_mmio_ring *coalesced_mmio_ring;\n    ...\n};\nstruct CPUState {\n    ...\n    int nr_cores;\n    int nr_threads;\n    ...\n    int kvm_fd;\n    struct KVMState *kvm_state;\n    struct kvm_run *kvm_run;\n    ...\n};\ntypedef struct CPUArchState {\n    /* standard registers */\n    target_ulong regs[CPU_NB_REGS];\n    target_ulong eip;\n    ...\n    uint64_t system_time_msr;\n    uint64_t wall_clock_msr;\n    ...\n    /* exception/interrupt handling */\n    int error_code;\n    int exception_is_int;\n    target_ulong exception_next_eip;\n    ...\n} CPUX86State;\n"}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"不同的-ioctl-对应的-fd"},"children":[{"type":"text","value":"不同的 ioctl 对应的 fd"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_ioctl: KVMState->fd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_vm_ioctl: KVMState->vmfd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_vcpu_ioctl: CPUState->kvm_fd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_device_ioctl: device fd"}]}]},{"type":"element","tag":"h3","props":{"id":"vcpu的创建和初始化"},"children":[{"type":"text","value":"vCPU的创建和初始化"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_init: 该函数open了/dev/kvm，并填入fd和vmfd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_init_vcpu: 该函数填入了CPUState->kvm_fd，并使用mmap分配了一块与KVM共享的内存区域。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_cpu_exec: 该函数invoke kvm_vcpu_ioctl with KVM_RUN"}]}]},{"type":"element","tag":"h3","props":{"id":"qemu的线程模型"},"children":[{"type":"text","value":"qemu的线程模型"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU-KVM 是一个多线程的，事件驱动的应用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n比较重要的threads 有："}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Main thread"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Worker threads for the virtual disk I/O backend"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"One thread for each vCPU"}]}]},{"type":"text","value":"\n对于每一个host上的vm，都对应一个host上的qemu进程。如果vm关机，则该进程销毁退出。\nguest的结构大致如下：\n"},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/kvm-guest.png"},"children":[]},{"type":"text","value":"\niothread 主要运行事件循环，如 main_loop_wait。\n主事件循环主要处理fd回调、bottom halves、timers等中断或io事件。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n注：bottom halves是中断处理的后半部，它的特点是 low overhead;scheduling them is wait-free, thread-safe, and signal-safe."}]},{"type":"element","tag":"h2","props":{"id":"kvm"},"children":[{"type":"text","value":"KVM"}]},{"type":"element","tag":"h3","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"加载了 kvm.ko 的 kernel 能发挥出 Hypervisor 的作用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nguest的物理地址空间是host的虚拟地址空间，包括 memory-mapped IO（kVM帮助实现了这一点）。\n除此之外，KVM还帮助我们做到了："}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"模拟指定的I/O设备。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"模拟指定的特权等级。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"使用vmentry运行guest的code，vmexit处理事件。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"还可以模拟事件，比如 virtual interrupt 和 page fault。"}]}]},{"type":"text","value":"\nKVM本身不是 Hypervisor （就好像React并不是一个完整的MVVM框架），但 QEMU 和 emulators 让它加冕为王。再加上硬件的虚拟化支持，使 Linux Kernel 成为一个完整的 Hypervisor 。\n"},{"type":"element","tag":"h3","props":{"id":"virsh"},"children":[{"type":"text","value":"virsh"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个命令行程序用于管理虚拟机（libvirt-client）。"}]},{"type":"element","tag":"h2","props":{"id":"refernce"},"children":[{"type":"text","value":"Refernce"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"图片来自 Master KVM Virtualization by Vedran Dakic | Humble Devassy Chirammal | Prasad Mukhedkar | Anil Vettathu"}]}]}]},"date":"2022-11-10","author":"tannal","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"常见的-hypervisordriver"},"children":[{"type":"text","value":"常见的 Hypervisor/Driver"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Xen"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VMware"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"LXC"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"QEMU"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VirtualBox"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Microsoft Hyper-V（BSD hypervisor）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"IBM PowerVM"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"OpenVZ"}]}]},{"type":"element","tag":"h2","props":{"id":"libvirt"},"children":[{"type":"text","value":"libvirt"}]},{"type":"element","tag":"h3","props":{"id":"libvirt-简介"},"children":[{"type":"text","value":"libvirt 简介"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"虽然是用C语言编写的，但是也有其他语言的Bindings，比如Java，Perl，C#，Python，Ruby"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"一个稳定的管理VM的API界面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"构建在hypervisor上面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Client-Server架构"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"实现vm的配置、添加、修改、监控、迁移等功能"}]}]},{"type":"element","tag":"h3","props":{"id":"libvirt-结构"},"children":[{"type":"text","value":"libvirt 结构"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"driver-based-architecture","src":"/assets/images/driver-based-architecture.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hypervisor是第一级driver，而诸如CPU、网络、disk等各种设备是第二级的driver（secondary-level driver)"}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"ts","title":"C"},"children":[{"type":"element","tag":"code","props":{"code":"struct _virConnectDriver {\n    /* Whether driver permits a server in the URI */\n    bool localOnly;\n    /* Whether driver needs a server in the URI */\n    bool remoteOnly;\n    /* Whether driver can be used in embedded mode */\n    bool embeddable;\n    /*\n    * NULL terminated list of supported URI schemes.\n    *  - Single element { NULL } list indicates no supported schemes\n    *  - NULL list indicates wildcard supporting all schemes\n    */\n    const char **uriSchemes;\n    virHypervisorDriver *hypervisorDriver;\n    virInterfaceDriver *interfaceDriver;\n    virNetworkDriver *networkDriver;\n    virNodeDeviceDriver *nodeDeviceDriver;\n    virNWFilterDriver *nwfilterDriver;\n    virSecretDriver *secretDriver;\n    virStorageDriver *storageDriver;\n};\n","language":"c"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" _virConnectDriver {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/* Whether driver permits a server in the URI */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" localOnly;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/* Whether driver needs a server in the URI */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" remoteOnly;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/* Whether driver can be used in embedded mode */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"bool"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" embeddable;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/*"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"    * NULL terminated list of supported URI schemes."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"    *  - Single element { NULL } list indicates no supported schemes"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"    *  - NULL list indicates wildcard supporting all schemes"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"    */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"char"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"**"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"uriSchemes;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virHypervisorDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"hypervisorDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virInterfaceDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"interfaceDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virNetworkDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"networkDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virNodeDeviceDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"nodeDeviceDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virNWFilterDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"nwfilterDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virSecretDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"secretDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    virStorageDriver "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"storageDriver;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"};"}]}]}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"libvirt支持的hypervisor以及对应源码的目录"},"children":[{"type":"text","value":"Libvirt支持的Hypervisor以及对应源码的目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• esx/: VMware ESX and GSX support using vSphere API over SOAP"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• hyperv/: Microsoft Hyper-V support using WinRM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• lxc/: Linux native containers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• openvz/: OpenVZ containers using CLI tools"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• phyp/: IBM Power Hypervisor using CLI tools over SSH"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• qemu/: QEMU/KVM using the QEMU CLI/monitor"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• remote/: Generic libvirt native RPC client"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• test/: A mock driver for testing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• uml/: User-mode Linux"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vbox/: VirtualBox using the native API"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vmware/: VMware Workstation and Player using the vmrun tool"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xen/: Xen using hypercalls, XenD SEXPR, and XenStore"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xenapi: Xen using libxenserver"}]}]},{"type":"element","tag":"h3","props":{"id":"第二级driver以及对应目录"},"children":[{"type":"text","value":"第二级driver以及对应目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• cpu/: CPU feature management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• interface/: Host network interface management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• network/: Virtual NAT networking"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• nwfilter/: Network traffic filtering rules"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• node_device/: Host device enumeration"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• secret/: Secret management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• security/: Mandatory access control drivers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• storage/: Storage management drivers"}]}]},{"type":"element","tag":"h3","props":{"id":"五个主要的对象以及它们之间的关系"},"children":[{"type":"text","value":"五个主要的对象以及它们之间的关系"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/api-objs.png"},"children":[]}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virConnectPtr: Libvirt需要连接到一个hypervisor，该对象代表了这种连接"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virDomainPtr: host和guest都被叫做domain，该对象表示一个主机"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStorageVolPtr: 代表存储系统的一卷（volume）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStoragePoolPtr: 一个volume是一个storage pool的一部分"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virNetworkPtr: 代表一个虚拟网络"}]}]},{"type":"element","tag":"h2","props":{"id":"qemu"},"children":[{"type":"text","value":"qemu"}]},{"type":"element","tag":"h3","props":{"id":"qemu是什么"},"children":[{"type":"text","value":"qemu是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU由Fabrice Bellard撰写，同时他也是ffmpeg的作者，以GPL协议开源。\n当它以emulater的角色工作时，它采用动态二进制翻译让机器可以跑另一种指令集的程序/OS。\n负责翻译工作的部分叫做TCG，它其实是个JIT（just in time）编译器。\n"},{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/tcg-qemu.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当它以virtualizer的角色工作时，就需要监控vm，与KVM通信合作实现带有硬件加速的虚拟化（部分指令直接跑在host主机上）。qemu利用POSIX Thread做到了这一点，也就是说，guest的vCPU其实是host的thread。\n"},{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/qemu-kvm.png"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"qemu源码预览"},"children":[{"type":"text","value":"qemu源码预览"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU-KVM 维护了一组CPU（X86）structures， 每一个vCPU对应一个结构。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n通用寄存器的内容记录在CPUState。"}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"KVMState","title":"C"},"children":[{"type":"element","tag":"code","props":{"code":"struct KVMState\n{\n    ...\n    int fd; //open /dev/kvm 后的file descriptor\n    int vmfd;\n    int coalesced_mmio;\n    int coalesced_pio;\n    struct kvm_coalesced_mmio_ring *coalesced_mmio_ring;\n    ...\n};\nstruct CPUState {\n    ...\n    int nr_cores;\n    int nr_threads;\n    ...\n    int kvm_fd;\n    struct KVMState *kvm_state;\n    struct kvm_run *kvm_run;\n    ...\n};\ntypedef struct CPUArchState {\n    /* standard registers */\n    target_ulong regs[CPU_NB_REGS];\n    target_ulong eip;\n    ...\n    uint64_t system_time_msr;\n    uint64_t wall_clock_msr;\n    ...\n    /* exception/interrupt handling */\n    int error_code;\n    int exception_is_int;\n    target_ulong exception_next_eip;\n    ...\n} CPUX86State;\n","language":"c"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" KVMState"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" fd; "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"//open /dev/kvm 后的file descriptor"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" vmfd;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" coalesced_mmio;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" coalesced_pio;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" kvm_coalesced_mmio_ring "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"coalesced_mmio_ring;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" CPUState {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" nr_cores;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" nr_threads;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" kvm_fd;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" KVMState "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"kvm_state;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" kvm_run "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"kvm_run;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"};"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"typedef"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"struct"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" CPUArchState {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/* standard registers */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    target_ulong "}]},{"type":"element","tag":"span","props":{"class":"ct-55787b"},"children":[{"type":"text","value":"regs"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"[CPU_NB_REGS];"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    target_ulong eip;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"uint64_t"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" system_time_msr;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"uint64_t"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" wall_clock_msr;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-d5707c"},"children":[{"type":"text","value":"/* exception/interrupt handling */"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" error_code;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e88d38"},"children":[{"type":"text","value":"int"}]},{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":" exception_is_int;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    target_ulong exception_next_eip;"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"    ..."}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-021046"},"children":[{"type":"text","value":"} CPUX86State;"}]}]}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"不同的-ioctl-对应的-fd"},"children":[{"type":"text","value":"不同的 ioctl 对应的 fd"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_ioctl: KVMState->fd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_vm_ioctl: KVMState->vmfd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_vcpu_ioctl: CPUState->kvm_fd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_device_ioctl: device fd"}]}]},{"type":"element","tag":"h3","props":{"id":"vcpu的创建和初始化"},"children":[{"type":"text","value":"vCPU的创建和初始化"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_init: 该函数open了/dev/kvm，并填入fd和vmfd"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_init_vcpu: 该函数填入了CPUState->kvm_fd，并使用mmap分配了一块与KVM共享的内存区域。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"kvm_cpu_exec: 该函数invoke kvm_vcpu_ioctl with KVM_RUN"}]}]},{"type":"element","tag":"h3","props":{"id":"qemu的线程模型"},"children":[{"type":"text","value":"qemu的线程模型"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU-KVM 是一个多线程的，事件驱动的应用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n比较重要的threads 有："}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Main thread"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Worker threads for the virtual disk I/O backend"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"One thread for each vCPU"}]}]},{"type":"text","value":"\n对于每一个host上的vm，都对应一个host上的qemu进程。如果vm关机，则该进程销毁退出。\nguest的结构大致如下：\n"},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/kvm-guest.png"},"children":[]},{"type":"text","value":"\niothread 主要运行事件循环，如 main_loop_wait。\n主事件循环主要处理fd回调、bottom halves、timers等中断或io事件。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n注：bottom halves是中断处理的后半部，它的特点是 low overhead;scheduling them is wait-free, thread-safe, and signal-safe."}]},{"type":"element","tag":"h2","props":{"id":"kvm"},"children":[{"type":"text","value":"KVM"}]},{"type":"element","tag":"h3","props":{"id":"概述"},"children":[{"type":"text","value":"概述"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"加载了 kvm.ko 的 kernel 能发挥出 Hypervisor 的作用。"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nguest的物理地址空间是host的虚拟地址空间，包括 memory-mapped IO（kVM帮助实现了这一点）。\n除此之外，KVM还帮助我们做到了："}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"模拟指定的I/O设备。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"模拟指定的特权等级。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"使用vmentry运行guest的code，vmexit处理事件。"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"还可以模拟事件，比如 virtual interrupt 和 page fault。"}]}]},{"type":"text","value":"\nKVM本身不是 Hypervisor （就好像React并不是一个完整的MVVM框架），但 QEMU 和 emulators 让它加冕为王。再加上硬件的虚拟化支持，使 Linux Kernel 成为一个完整的 Hypervisor 。\n"},{"type":"element","tag":"h3","props":{"id":"virsh"},"children":[{"type":"text","value":"virsh"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个命令行程序用于管理虚拟机（libvirt-client）。"}]},{"type":"element","tag":"h2","props":{"id":"refernce"},"children":[{"type":"text","value":"Refernce"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"图片来自 Master KVM Virtualization by Vedran Dakic | Humble Devassy Chirammal | Prasad Mukhedkar | Anil Vettathu"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-55787b{color:#953800}.ct-d5707c{color:#6E7781}.ct-021046{color:#24292F}.ct-e88d38{color:#CF222E}.dark .ct-e88d38{color:#FF7B72}.dark .ct-021046{color:#C9D1D9}.dark .ct-d5707c{color:#8B949E}.dark .ct-55787b{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"常见的-hypervisordriver","depth":2,"text":"常见的 Hypervisor/Driver"},{"id":"libvirt","depth":2,"text":"libvirt","children":[{"id":"libvirt-简介","depth":3,"text":"libvirt 简介"},{"id":"libvirt-结构","depth":3,"text":"libvirt 结构"},{"id":"libvirt支持的hypervisor以及对应源码的目录","depth":3,"text":"Libvirt支持的Hypervisor以及对应源码的目录"},{"id":"第二级driver以及对应目录","depth":3,"text":"第二级driver以及对应目录"},{"id":"五个主要的对象以及它们之间的关系","depth":3,"text":"五个主要的对象以及它们之间的关系"}]},{"id":"qemu","depth":2,"text":"qemu","children":[{"id":"qemu是什么","depth":3,"text":"qemu是什么？"},{"id":"qemu源码预览","depth":3,"text":"qemu源码预览"},{"id":"不同的-ioctl-对应的-fd","depth":3,"text":"不同的 ioctl 对应的 fd"},{"id":"vcpu的创建和初始化","depth":3,"text":"vCPU的创建和初始化"},{"id":"qemu的线程模型","depth":3,"text":"qemu的线程模型"}]},{"id":"kvm","depth":2,"text":"KVM","children":[{"id":"概述","depth":3,"text":"概述"},{"id":"virsh","depth":3,"text":"virsh"}]},{"id":"refernce","depth":2,"text":"Refernce"}]}},"_type":"markdown","_id":"content:post:1.kvm-intro.md","_source":"content","_file":"post/1.kvm-intro.md","_extension":"md"},{"_path":"/post/hello-world","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Hello World","description":"Hello !!!, this is a post about hello world hand demo Syntax Highlight Code.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from \"de Finibus Bonorum et Malorum\" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham."}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"ts","title":"TypeScript"},"children":[{"type":"element","tag":"code","props":{"code":"import React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { createStore } from 'redux';\nimport { enthusiasm } from './reducers/index';\nimport { StoreState } from './types/index';\nimport App from './components/App';\nimport './index.css';\n\nconst store = createStore<StoreState>(enthusiasm, {\n  enthusiasmLevel: 1,\n  languageName: 'TypeScript',\n});\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { createStore } from 'redux';\nimport { enthusiasm } from './reducers/index';\nimport { StoreState } from './types/index';\nimport App from './components/App';\nimport './index.css';\n\nconst store = createStore<StoreState>(enthusiasm, {\n  enthusiasmLevel: 1,\n  languageName: 'TypeScript',\n});\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n"}]}]}]}]}]}]}]},"date":"2022-06-29","author":"viandwi24","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from \"de Finibus Bonorum et Malorum\" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham."}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"ts","title":"TypeScript"},"children":[{"type":"element","tag":"code","props":{"code":"import React from 'react';\nimport { render } from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { createStore } from 'redux';\nimport { enthusiasm } from './reducers/index';\nimport { StoreState } from './types/index';\nimport App from './components/App';\nimport './index.css';\n\nconst store = createStore<StoreState>(enthusiasm, {\n  enthusiasmLevel: 1,\n  languageName: 'TypeScript',\n});\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n","language":"ts"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" React "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'react'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" { render } "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'react-dom'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" { Provider } "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'react-redux'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" { createStore } "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'redux'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" { enthusiasm } "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'./reducers/index'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" { StoreState } "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'./types/index'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" App "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'./components/App'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'./index.css'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-7acd88"},"children":[{"type":"text","value":"store"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b4619e"},"children":[{"type":"text","value":"createStore"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-ffe6e6"},"children":[{"type":"text","value":"StoreState"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":">(enthusiasm, {"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"  enthusiasmLevel: "}]},{"type":"element","tag":"span","props":{"class":"ct-7acd88"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"  languageName: "}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'TypeScript'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"});"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-b4619e"},"children":[{"type":"text","value":"render"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"Provider store"}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"{store}"}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":">"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"App "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"/>"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":"</"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"Provider"}]},{"type":"element","tag":"span","props":{"class":"ct-0d41cf"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"  document."}]},{"type":"element","tag":"span","props":{"class":"ct-b4619e"},"children":[{"type":"text","value":"getElementById"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-97b1c8"},"children":[{"type":"text","value":"'root'"}]},{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"span","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dbb143"},"children":[{"type":"text","value":");"}]}]}]}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-ffe6e6{color:#953800}.ct-b4619e{color:#8250DF}.ct-7acd88{color:#0550AE}.ct-97b1c8{color:#0A3069}.ct-dbb143{color:#24292F}.ct-0d41cf{color:#CF222E}.dark .ct-0d41cf{color:#FF7B72}.dark .ct-dbb143{color:#C9D1D9}.dark .ct-97b1c8{color:#A5D6FF}.dark .ct-7acd88{color:#79C0FF}.dark .ct-b4619e{color:#D2A8FF}.dark .ct-ffe6e6{color:#FFA657}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:post:hello-world.md","_source":"content","_file":"post/hello-world.md","_extension":"md"},{"_path":"/post/lorem","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"Lorem Post","description":"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from \"de Finibus Bonorum et Malorum\" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham."}]}]},"date":"2022-06-29","author":"viandwi24","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from \"de Finibus Bonorum et Malorum\" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:post:lorem.md","_source":"content","_file":"post/lorem.md","_extension":"md"},{"_path":"/post/test","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"CONTENT_TITLE","description":"CONTENT_DESCRIPTION","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"CONTENT_BODY"}]}]},"date":"2022-06-29","author":"viandwi24","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"CONTENT_BODY"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:post:test.md","_source":"content","_file":"post/test.md","_extension":"md"}],"navigation":[{"title":"Page","_path":"/page","children":[{"title":"Getting Started","_path":"/page/getting-started"}]},{"title":"Post","_path":"/post","children":[{"title":"虚拟化第一篇 Hypervisor、Libvirt、QEMU和KVM简介","_path":"/post/kvm-intro"},{"title":"Hello World","_path":"/post/hello-world"},{"title":"Lorem Post","_path":"/post/lorem"},{"title":"CONTENT_TITLE","_path":"/post/test"}]}]}