[{"_path":"/post/kvm-intro","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"KVM简介第一篇——Libvirt","description":"这是QEMU/KVM系列文章的第一篇","excerpt":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"常见的-hypervisordriver"},"children":[{"type":"text","value":"常见的 Hypervisor/Driver"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Xen"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VMware"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"LXC"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"QEMU"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"VirtualBox"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Microsoft Hyper-V（BSD hypervisor）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"IBM PowerVM"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"OpenVZ"}]}]},{"type":"element","tag":"h2","props":{"id":"libvirt-简介"},"children":[{"type":"text","value":"libvirt 简介"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"虽然是用C语言编写的，但是也有其他语言的Bindings，比如Java，Perl，C#，Python，Ruby"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"一个稳定的管理VM的API界面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"构建在hypervisor上面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Client-Server架构"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"实现vm的配置、添加、修改、监控、迁移等功能"}]}]},{"type":"element","tag":"h2","props":{"id":"libvirt-结构"},"children":[{"type":"text","value":"libvirt 结构"}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"driver-based architecture"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"构建在hypervisor上面"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"Client-Server架构"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"实现vm的配置、添加、修改、监控、迁移等功能"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"driver-based-architecture-图片来自Master KVM Virtualization by Vedran Dakic | Humble Devassy Chirammal | Prasad Mukhedkar | Anil Vettathu","src":"/assets/images/driver-based-architecture.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hypervisor是第一级driver，而诸如CPU、网络、disk等各种设备是第二级的driver（secondary-level driver)"}]},{"type":"element","tag":"div","props":{"class":"py-4"},"children":[{"type":"element","tag":"tabs","props":{},"children":[{"type":"element","tag":"tab","props":{"name":"ts","title":"C"},"children":[{"type":"element","tag":"code","props":{"code":"struct _virConnectDriver {\n    /* Whether driver permits a server in the URI */\n    bool localOnly;\n    /* Whether driver needs a server in the URI */\n    bool remoteOnly;\n    /* Whether driver can be used in embedded mode */\n    bool embeddable;\n    /*\n    * NULL terminated list of supported URI schemes.\n    *  - Single element { NULL } list indicates no supported schemes\n    *  - NULL list indicates wildcard supporting all schemes\n    */\n    const char **uriSchemes;\n    virHypervisorDriver *hypervisorDriver;\n    virInterfaceDriver *interfaceDriver;\n    virNetworkDriver *networkDriver;\n    virNodeDeviceDriver *nodeDeviceDriver;\n    virNWFilterDriver *nwfilterDriver;\n    virSecretDriver *secretDriver;\n    virStorageDriver *storageDriver;\n};\n","language":"c"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"struct _virConnectDriver {\n    /* Whether driver permits a server in the URI */\n    bool localOnly;\n    /* Whether driver needs a server in the URI */\n    bool remoteOnly;\n    /* Whether driver can be used in embedded mode */\n    bool embeddable;\n    /*\n    * NULL terminated list of supported URI schemes.\n    *  - Single element { NULL } list indicates no supported schemes\n    *  - NULL list indicates wildcard supporting all schemes\n    */\n    const char **uriSchemes;\n    virHypervisorDriver *hypervisorDriver;\n    virInterfaceDriver *interfaceDriver;\n    virNetworkDriver *networkDriver;\n    virNodeDeviceDriver *nodeDeviceDriver;\n    virNWFilterDriver *nwfilterDriver;\n    virSecretDriver *secretDriver;\n    virStorageDriver *storageDriver;\n};\n"}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"libvirt支持的hypervisor以及对应源码的目录"},"children":[{"type":"text","value":"Libvirt支持的Hypervisor以及对应源码的目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• esx/: VMware ESX and GSX support using vSphere API over SOAP"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• hyperv/: Microsoft Hyper-V support using WinRM"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• lxc/: Linux native containers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• openvz/: OpenVZ containers using CLI tools"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• phyp/: IBM Power Hypervisor using CLI tools over SSH"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• qemu/: QEMU/KVM using the QEMU CLI/monitor"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• remote/: Generic libvirt native RPC client"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• test/: A mock driver for testing"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• uml/: User-mode Linux"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vbox/: VirtualBox using the native API"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• vmware/: VMware Workstation and Player using the vmrun tool"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xen/: Xen using hypercalls, XenD SEXPR, and XenStore"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• xenapi: Xen using libxenserver"}]}]},{"type":"element","tag":"h3","props":{"id":"第二级driver以及对应目录"},"children":[{"type":"text","value":"第二级driver以及对应目录"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• cpu/: CPU feature management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• interface/: Host network interface management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• network/: Virtual NAT networking"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• nwfilter/: Network traffic filtering rules"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• node_device/: Host device enumeration"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• secret/: Secret management"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• security/: Mandatory access control drivers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"• storage/: Storage management drivers"}]}]},{"type":"element","tag":"h3","props":{"id":"五个主要的对象以及它们之间的关系"},"children":[{"type":"text","value":"五个主要的对象以及它们之间的关系"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"/assets/images/api-objs.png"},"children":[]}]},{"type":"element","tag":"ul","props":{"className":["ml-8"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virConnectPtr: Libvirt需要连接到一个hypervisor，该对象代表了这种连接"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virDomainPtr: host和guest都被叫做domain，该对象表示一个主机"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStorageVolPtr: 代表存储系统的一卷（volume）"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virStoragePoolPtr: 一个volume是一个storage pool的一部分"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"li","props":{"className":["list-disc"]},"children":[{"type":"text","value":"virNetworkPtr: 代表一个虚拟网络"}]}]},{"type":"element","tag":"h2","props":{"id":"qemu"},"children":[{"type":"text","value":"qemu"}]},{"type":"element","tag":"h3","props":{"id":"qemu是什么"},"children":[{"type":"text","value":"qemu是什么？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"QEMU由Fabrice Bellard撰写，同时他也是ffmpeg的作者，以GPL协议开源。\n当它以emulater的角色工作时，它采用动态二进制翻译让机器可以跑另一种指令集的程序/OS。\n负责翻译工作的部分叫做TCG，它其实是个JIT（just in time）编译器。\n当它以virtualizer的角色工作时，就需要监控vm，与KVM通信合作。"}]},{"type":"element","tag":"h3","props":{"id":"virsh"},"children":[{"type":"text","value":"virsh"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一个命令行程序用于管理虚拟机（libvirt-client）\n即使emulater也是virtualizer"}]}]},"date":"2022-11-10","author":"tannal","_type":"markdown","_id":"content:post:kvm-intro.md","_source":"content","_file":"post/kvm-intro.md","_extension":"md"},{"_path":"/post/test","_dir":"post","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"CONTENT_TITLE","description":"CONTENT_DESCRIPTION","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"CONTENT_BODY"}]}]},"date":"2022-06-29","author":"viandwi24","_type":"markdown","_id":"content:post:test.md","_source":"content","_file":"post/test.md","_extension":"md"}]